<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="cloudinary.html">

<dom-module id="cloudinary-img">

	<template>
    <style>

      :host {
        display: inline-block;
      }

      :host[block] {
        display: block;
      }

      img {
        max-width: 100%;
      }

      :host[block] img {
        display: block;
      }

    </style>

    <img src$="[[src]]" alt$="[[alt]]" sizes$="[[sizes]]">
  </template>

  <script>

    Polymer({

      is: 'cloudinary-img',

      ready: function() {

      },

      behaviors: [

      ],

      properties: {
      	cloudinaryApi: {
      		type: String,
      		readOnly: true,
      		value: '//res.cloudinary.com/'
      	},

      	cloudName: {
      		type: String
      	},

      	path: {
      		type: String
      	},

      	transformationParams: {
      		type: String,
      		value: ''
      	},

      	alt: {
      		type: String
      	},

      	sizes: {
      		type: String,
      		value: '100vw'
      	},

        fileFormat: {
          type: String,
          value: '' // http://cloudinary.com/documentation/image_transformations#image_format_conversion
        },

      	src: {
      		type: String,
      		notify: true,
      		computed: '_computeSrc(cloudinaryApi, cloudName, path, transformationParams, fileFormat)'
      	}
      },

      _computeSrc: function(cloudinaryApi, cloudName, path, transformationParams, fileFormat) {
        if (!path) {
          return '';
        }

      	var src = cloudinaryApi + cloudName;

      	if (transformationParams) {
      		src += '/' + transformationParams;
      	}

        src = src + '/' + path;

        if (fileFormat) {
          src = src.replace(/\.[^\.]+$/, '.' + fileFormat);
        }

      	return src;
      }

    });

  </script>

</dom-module>
